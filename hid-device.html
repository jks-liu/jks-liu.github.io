<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>HID 设备简介</title>
<meta name="author" content="(Jks Liu)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/theme/moon.css" id="theme"/>


<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://cdn.jsdelivr.net/npm/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">HID 设备简介</h1><h2 class="author">Jks Liu</h2><p class="date">Created: 2021-12-06 Mon 22:47</p>
</section>
<section id="sec-table-of-contents"><div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#/slide-orge36297f">1. 参考文献</a></li>
<li><a href="#/slide-org045f470">2. 简介</a></li>
<li><a href="#/slide-org2309d3e">3. Usage 类型</a></li>
<li><a href="#/slide-org741134d">4. 报告描述符，Report Descriptor</a></li>
</ul>
</div>
</div>
</section>

<section>
<section id="slide-orge36297f">
<h2 id="orge36297f"><span class="section-number-2">1</span> 参考文献</h2>
<ul>
<li><i>Device Class Definition for HID 1.11 1.11</i></li>
<li><i>HID Usage Tables 1.22</i></li>

</ul>
</section>
</section>
<section>
<section id="slide-org045f470">
<h2 id="org045f470"><span class="section-number-2">2</span> 简介</h2>
<ul>
<li>HID（Human interface device）原先用于 USB 系统。</li>
<li>现在，HID 可以支持蓝牙、I2C、SPI等等，不再局限于 USB。</li>

</ul>
</section>
</section>
<section>
<section id="slide-org2309d3e">
<h2 id="org2309d3e"><span class="section-number-2">3</span> Usage 类型</h2>
<p>
Usages 描述了三种基本类型的信息
<b>控制 controls</b>, <b>数据 data</b> 和 <b>集合 collections</b>.
</p>
</section>
</section>
<section>
<section id="slide-org31ca3bd">
<h3 id="org31ca3bd"><span class="section-number-3">3.1</span> 控制 Controls</h3>
<div class="outline-text-3" id="text-3-1">
</div>
</section>
<section id="slide-org4bb105b">
<h4 id="org4bb105b"><span class="section-number-4">3.1.1</span> 线性控制，Linear Control (LC)</h4>
<p>
例
</p>
<ul>
<li>加减按钮</li>
<li>旋钮</li>
<li>滑块</li>

</ul>
</section>
<section id="slide-orgc9e8af7">
<h4 id="orgc9e8af7"><span class="section-number-4">3.1.2</span> 开关控制，On/Off Control (OOC)</h4>
<p>
例
</p>
<ul>
<li>两个按钮，一个开、一个关</li>
<li>一个单独的按钮，按一下切换开关状态</li>
<li>一个有两种状态的开关</li>

</ul>
</section>
<section id="slide-org46cbf35">
<h4 id="org46cbf35"><span class="section-number-4">3.1.3</span> 瞬时控制，Momentary Control (MC)</h4>
<ul>
<li>一个基本的按钮</li>

</ul>
</section>
<section id="slide-org2f93a6e">
<h4 id="org2f93a6e"><span class="section-number-4">3.1.4</span> One Shot Control (OSC)</h4>
</section>
<section id="slide-org7d790ce">
<h4 id="org7d790ce"><span class="section-number-4">3.1.5</span> Re-Trigger Control (RTC)</h4>
</section>
</section>
<section>
<section id="slide-orgf4e3485">
<h3 id="orgf4e3485"><span class="section-number-3">3.2</span> 数据 Data</h3>
<div class="outline-text-3" id="text-3-2">
</div>
</section>
<section id="slide-org4168048">
<h4 id="org4168048"><span class="section-number-4">3.2.1</span> 选择器，Selector (Sel)</h4>
<ul>
<li>单选，One selection of a set</li>
<li><i>N</i> 选，/N/ selections of a set</li>
<li>任意多选，Any selection of a set</li>

</ul>
</section>
<section id="slide-org47e586c">
<h4 id="org47e586c"><span class="section-number-4">3.2.2</span> Static Value (SV)</h4>
<p>
声明固定的特性。 <br />
Constant and read-only.
</p>
</section>
<section id="slide-org8bdcf25">
<h4 id="org8bdcf25"><span class="section-number-4">3.2.3</span> Static Flag (SF)</h4>
<p>
声明某个特定特性的存在。
</p>
</section>
<section id="slide-orgeaf823a">
<h4 id="orgeaf823a"><span class="section-number-4">3.2.4</span> Dynamic Flag (DF)</h4>
<ul>
<li>声明某个主机可控的特性存在。</li>

</ul>
</section>
<section id="slide-orged16a3b">
<h4 id="orged16a3b"><span class="section-number-4">3.2.5</span> Dynamic Value (DV)</h4>
<ul>
<li>一个绑定 control 的 <i>n</i>-bit 区域</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgeda6f8b">
<h3 id="orgeda6f8b"><span class="section-number-3">3.3</span> 集合 Collection</h3>
<div class="outline-text-3" id="text-3-3">
</div>
</section>
<section id="slide-org4f87381">
<h4 id="org4f87381"><span class="section-number-4">3.3.1</span> 命名数组，Named Array (NAry)</h4>
<p>
Simplify for an application the process if finding a set of selectors,
whether defined as an <b>Array Field</b> or a <b>bitmap</b>.
</p>
</section>
<section id="slide-orgd660e52">
<h4 id="orgd660e52"><span class="section-number-4">3.3.2</span> 应用集合，Collection Application (CA)</h4>
<p>
标识仅在应用程序级集合中使用的 usage。
</p>
<p class="fragment roll-in">
标识复杂设备的一个 HID 设备或功能子集。
</p>
<p class="fragment roll-in">
操作系统使用与此集合关联的 usage 将设备链接到其控制应用程序或驱动程序。
</p>
<p class="fragment roll-in">
比如：鼠标、键盘
</p>
</section>
<section id="slide-orgf548425">
<h4 id="orgf548425"><span class="section-number-4">3.3.3</span> 其它</h4>
<ul>
<li>Collection Logical (CL)</li>
<li>Collection Physical (CP)</li>
<li>Usage Switch (US)</li>
<li>Usage Modifier (UM)</li>

</ul>
</section>
</section>
<section>
<section id="slide-org741134d">
<h2 id="org741134d"><span class="section-number-2">4</span> 报告描述符，Report Descriptor</h2>
<blockquote >
<p>
<b>Report</b> 描述符由信息片段组成. 每片信息叫做一个 <b>Item</b>.
</p>
</blockquote>
</section>
</section>
<section>
<section id="slide-org8a43b40">
<h3 id="org8a43b40"><span class="section-number-3">4.1</span> Item 格式</h3>

<div class="figure">
<p><img src="./pictures/hid/short items.png" alt="short items.png" class="fragment roll-in" />
</p>
<p><span class="figure-number">Figure 1: </span>短 items</p>
</div>

<div class="figure">
<p><img src="./pictures/hid/long items.png" alt="long items.png" class="fragment roll-in" />
</p>
<p><span class="figure-number">Figure 2: </span>长 items</p>
</div>
</section>
</section>
<section>
<section id="slide-org4c9a03e">
<h3 id="org4c9a03e"><span class="section-number-3">4.2</span> Item Parser</h3>
<p>
解析器在遍历描述符时收集每个已知 item 的状态，并将它们存储在 item 状态表中。
</p>
</section>
<section id="slide-org498fb88">
<h4 id="org498fb88"><span class="section-number-4">4.2.1</span> 流程</h4>

<div class="figure">
<p><img src="./pictures/hid/item parser.png" alt="item parser.png" />
</p>
</div>
</section>
<section id="slide-org0d6a12f">
<h4 id="org0d6a12f"><span class="section-number-4">4.2.2</span> <b>Main</b>, <b>Push</b>, and <b>Pop</b> items</h4>
<aside class="notes">
<ul>
<li>When a Main item is found, a new report structure is allocated and initialized
with the current item state table.
每当找到一个 Main item 时，一个新的 report 结构被分配并使用当前 item 状态表进行初始化。</li>

</ul>

</aside>
<p>
所有的 Local items 被从 item 状态表中删除, 但是 Global items 被保留.
</p>
</section>
</section>
<section>
<section id="slide-org9437f16">
<h3 id="org9437f16"><span class="section-number-3">4.3</span> Usage</h3>
<p>
Usage (32 bits) = Usage Page (16 bits) + Usage ID (16 bits)
</p>
</section>
</section>
<section>
<section id="slide-org415a8d6">
<h3 id="org415a8d6"><span class="section-number-3">4.4</span> 报告，Report</h3>
<ul>
<li>输入，Input</li>
<li>输出，Output</li>
<li>特性，Feature</li>

</ul>
</section>
<section id="slide-org89cb6f3">
<h4 id="org89cb6f3"><span class="section-number-4">4.4.1</span> Report ID</h4>
<p>
一个 <b>Report ID</b> item 标记为每个 report 传输分配一个1字节的标识前缀。
</p>
<aside class="notes">
<p>
如果在报告描述符中没有 <b>Report ID</b> item 标签，可以假设只有一个 <b>Input*、*Output</b> 和 <b>Feature</b> 报告结构存在，它们一起代表设备的所有数据。
</p>

</aside>
</section>
</section>
<section>
<section id="slide-org392c2ef">
<h3 id="org392c2ef"><span class="section-number-3">4.5</span> 多字节数值格式</h3>
<aside class="notes">
<p>
报告中的多字节数值以小端格式表示，最低有效字节位于最低地址。
</p>

</aside>

<div class="figure">
<p><img src="./pictures/hid/Format of Multibyte Numeric Values.PNG" alt="Format of Multibyte Numeric Values.PNG" />
</p>
</div>
</section>
</section>
<section>
<section id="slide-org99a460e">
<h3 id="org99a460e"><span class="section-number-3">4.6</span> 方向</h3>
<p>
<b>HID</b> 类型的设备被 <i>鼓励</i> 尽可能地使用右手坐标系。
</p>
<aside class="notes">
<p>
如果用户面对一个设备，报告值应该随着控件从左到右(X)、从远到近(Y)和从高到低(Z)的移动而增加。
</p>

</aside>

<div class="figure">
<p><img src="./pictures/hid/Orientation.png" alt="Orientation.png" />
</p>
</div>
</section>
</section>
<section>
<section id="slide-org271fb73">
<h3 id="org271fb73"><span class="section-number-3">4.7</span> Null Values</h3>
<p>
HID类设备支持在运行时忽略报表中选定字段的能力。<br />
 <b>如。</b> <br />
 如果声明了一个8位的字段，并且有效值的范围是0到0x7F，那么在0x80到0xFF之间的任何值都将被认为超出范围，并在接收时被忽略。
</p>
<aside class="notes">
<p>
这是通过在报告中声明位字段来实现的，该报告能够包含比控件实际生成的值更大的值范围。如果主机或设备接收到超出范围的值，则各自控制的当前值将不会被修改。<br />
<b>提示</b>
-如果null值都是相同的，那么在报告中初始化null值就容易得多。
-强烈建议将0包含在Null值的集合中，这样报告缓冲区就可以简单地设置为0，以建立所有字段的“不关心”状态。
</p>

</aside>
</section>
</section>
<section>
<section id="slide-org4f9bb92">
<h3 id="org4f9bb92"><span class="section-number-3">4.8</span> Report Descriptors</h3>
<ul>
<li><b>Report</b> 描述符由提供设备信息的 items 组成。</li>
<li>项目的第一部分包含三个字段: <b>item 类型*、 *item 标签（tags）</b> 和 *item大小*。</li>
<li>这些字段一起标识项目提供的 <b>信息</b> 的类型。</li>

</ul>
</section>
<section id="slide-org6625483">
<h4 id="org6625483"><span class="section-number-4">4.8.1</span> Item 类型</h4>
<ul>
<li>Main</li>
<li>Global</li>
<li>Local</li>

</ul>
</section>
<section id="slide-org70a6fd5">
<h4 id="org70a6fd5"><span class="section-number-4">4.8.2</span> Main Item tags</h4>
<ul>
<li>Input</li>
<li>Output</li>
<li>Feature</li>
<li>Collection</li>
<li>End Collection</li>

</ul>
</section>
<section id="slide-org3ac9554">
<h4 id="org3ac9554"><span class="section-number-4">4.8.3</span> Input item tag</h4>
<p>
指来自设备上一个或多个类似控件的数据。例如，可变数据，如读取单个轴的位置或一组杠杆或数组数据，如一个或多个按钮或开关。
</p>
</section>
<section id="slide-org3ef0cae">
<h4 id="org3ef0cae"><span class="section-number-4">4.8.4</span> Output item tag</h4>
<p>
指设备上一个或多个类似控件的数据，如设置单个轴或一组杠杆的位置(可变数据)。或者，它可以将数据表示为一个或多个 LED (数组数据)。
</p>
</section>
<section id="slide-org823e2a9">
<h4 id="org823e2a9"><span class="section-number-4">4.8.5</span> Feature item tag</h4>
<p>
描述终端用户不打算使用的设备输入和输出—例如，软件特性或控制面板切换。
</p>
</section>
<section id="slide-orgc926675">
<h4 id="orgc926675"><span class="section-number-4">4.8.6</span> Collection item tag</h4>
<p>
输入、输出和特性项的有意义分组。例如鼠标、键盘、操纵杆和指针。
</p>
</section>
<section id="slide-org3fc97fb">
<h4 id="org3fc97fb"><span class="section-number-4">4.8.7</span> End Collection item tag</h4>
<p>
一种终止项，用于指定项集合的结束。
</p>
</section>
<section id="slide-org4f42877">
<h4 id="org4f42877"><span class="section-number-4">4.8.8</span> 例</h4>
<div class="org-src-container">

<pre  class="src src-scheme"   ><code trim>Report Size <span style="color: #DCDCCC;">(</span>3<span style="color: #DCDCCC;">)</span>
Report Count <span style="color: #DCDCCC;">(</span>2<span style="color: #DCDCCC;">)</span>
Input
Report Size <span style="color: #DCDCCC;">(</span>8<span style="color: #DCDCCC;">)</span>
Input
Output
</code></pre>
</div>

<div class="figure">
<p><img src="./pictures/hid/Report Descriptor mini-example.png" alt="Report Descriptor mini-example.png" class="fragment roll-in" />
</p>
<p><span class="figure-number">Figure 6: </span>LSB is on the left</p>
</div>
</section>
<section id="slide-orga82c54d">
<h4 id="orga82c54d"><span class="section-number-4">4.8.9</span> 必选 items</h4>
<ul>
<li>Input (Output or Feature)</li>
<li>Usage</li>
<li>Usage Page</li>
<li>Logical Minimum</li>
<li>Logical Maximum</li>
<li>Report Size</li>
<li>Report Count</li>

</ul>
</section>
<section id="slide-org08a5851">
<h4 id="org08a5851"><span class="section-number-4">4.8.10</span> 例：三键鼠标</h4>
<div class="org-src-container">

<pre  class="src src-scheme"   ><code trim>Usage Page <span style="color: #DCDCCC;">(</span>Generic Desktop<span style="color: #DCDCCC;">)</span>,      <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">Use the Generic Desktop Usage Page</span>
Usage <span style="color: #DCDCCC;">(</span>Mouse<span style="color: #DCDCCC;">)</span>,
    Collection <span style="color: #DCDCCC;">(</span>Application<span style="color: #DCDCCC;">)</span>,           <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">Start Mouse collection</span>
    Usage <span style="color: #DCDCCC;">(</span>Pointer<span style="color: #DCDCCC;">)</span>,
    Collection <span style="color: #DCDCCC;">(</span>Physical<span style="color: #DCDCCC;">)</span>,              <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">Start Pointer collection</span>
        Usage Page <span style="color: #DCDCCC;">(</span>Buttons<span style="color: #DCDCCC;">)</span>
        Usage Minimum <span style="color: #DCDCCC;">(</span>1<span style="color: #DCDCCC;">)</span>,
        Usage Maximum <span style="color: #DCDCCC;">(</span>3<span style="color: #DCDCCC;">)</span>,
        Logical Minimum <span style="color: #DCDCCC;">(</span>0<span style="color: #DCDCCC;">)</span>,
        Logical Maximum <span style="color: #DCDCCC;">(</span>1<span style="color: #DCDCCC;">)</span>,         <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">Fields return values from 0 to 1</span>
        Report Count <span style="color: #DCDCCC;">(</span>3<span style="color: #DCDCCC;">)</span>,
        Report Size <span style="color: #DCDCCC;">(</span>1<span style="color: #DCDCCC;">)</span>, <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">Create three 1 bit fields (button 1, 2, &amp; 3)</span>
        Input <span style="color: #DCDCCC;">(</span>Data, Variable, Absolute<span style="color: #DCDCCC;">)</span>, <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">Add fields to the input report.</span>
        Report Count <span style="color: #DCDCCC;">(</span>1<span style="color: #DCDCCC;">)</span>,
        Report Size <span style="color: #DCDCCC;">(</span>5<span style="color: #DCDCCC;">)</span>,                <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">Create 5 bit constant field</span>
        Input <span style="color: #DCDCCC;">(</span>Constant<span style="color: #DCDCCC;">)</span>,               <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">Add field to the input report</span>
        Usage Page <span style="color: #DCDCCC;">(</span>Generic Desktop<span style="color: #DCDCCC;">)</span>,
        Usage <span style="color: #DCDCCC;">(</span>X<span style="color: #DCDCCC;">)</span>,
        Usage <span style="color: #DCDCCC;">(</span>Y<span style="color: #DCDCCC;">)</span>,
        Logical Minimum <span style="color: #DCDCCC;">(</span>-127<span style="color: #DCDCCC;">)</span>,
        Logical Maximum <span style="color: #DCDCCC;">(</span>127<span style="color: #DCDCCC;">)</span>,  <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">Fields return values from -127 to 127</span>
        Report Size <span style="color: #DCDCCC;">(</span>8<span style="color: #DCDCCC;">)</span>,
        Report Count <span style="color: #DCDCCC;">(</span>2<span style="color: #DCDCCC;">)</span>,    <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">Create two 8 bit fields (X &amp; Y position)</span>
        Input <span style="color: #DCDCCC;">(</span>Data, Variable, Relative<span style="color: #DCDCCC;">)</span>, <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">Add fields to the input report</span>
    End Collection,                       <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">Close Pointer collection</span>
End Collection                            <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">Close Mouse collection</span>
</code></pre>
</div>
</section>
</section>
<section>
<section id="slide-org509b22e">
<h3 id="org509b22e"><span class="section-number-3">4.9</span> Main item 语义</h3>
<p>
仅短 items
</p>
</section>
<section id="slide-org120fb36">
<h4 id="org120fb36"><span class="section-number-4">4.9.1</span> bSize</h4>
<p>
0 = 0 字节 <br />
1 = 1 字节 <br />
2 = 2 字节 <br />
3 = 4 字节 <br />
</p>
</section>
<section id="slide-org043d6d6">
<h4 id="org043d6d6"><span class="section-number-4">4.9.2</span> bType</h4>
<p>
0 = Main <br />
1 = Global <br />
2 = Local <br />
3 = Reserved <br />
</p>
</section>
<section id="slide-org4be2745">
<h4 id="org4be2745"><span class="section-number-4">4.9.3</span> bTag</h4>
<p>
指定 item 功能地数值表达式
</p>
</section>
<section id="slide-org7e03c9f">
<h4 id="org7e03c9f"><span class="section-number-4">4.9.4</span> [data]</h4>
<p>
可选数据
</p>
</section>
<section id="slide-org8b588cc">
<h4 id="org8b588cc"><span class="section-number-4">4.9.5</span> Input tag</h4>
<aside class="notes">
<p>
Page 28 (38) <br />
Global Items 35 (45) <br />
Local Items 39 (49)
</p>

</aside>

<div class="figure">
<p><img src="./pictures/hid/input tag.PNG" alt="input tag.PNG" />
</p>
</div>
</section>
<section id="slide-org0109166">
<h4 id="org0109166"><span class="section-number-4">4.9.6</span> Output tag</h4>

<div class="figure">
<p><img src="./pictures/hid/output tag.PNG" alt="output tag.PNG" />
</p>
</div>
</section>
<section id="slide-org9816abd">
<h4 id="org9816abd"><span class="section-number-4">4.9.7</span> Feature tag</h4>

<div class="figure">
<p><img src="./pictures/hid/feature tag.PNG" alt="feature tag.PNG" />
</p>
</div>
</section>
</section>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]

});

</script>
</body>
</html>
